<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>æ‰‹æ©Ÿé˜²æ¯’å‡ç´šç‰ˆ</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
    body {
        background: black;
        color: #00ff00;
        font-family: "Courier New", monospace;
        font-size: 16px;
        text-align: center;
        padding-top: 50px;
        overflow: hidden;
    }
    h1 {
        font-size: 40px;
    }
    .blink { animation: blink 0.7s infinite; }
    @keyframes blink { 50% { opacity: 0; } }
    #bar {
        width: 80%;
        height: 25px;
        border: 2px solid #00ff00;
        margin: 20px auto;
        position: relative;
        display: none;
    }
    #fill {
        height: 100%;
        width: 0%;
    }
    .spark {
        position: absolute;
        width: 5px;
        height: 5px;
        background: yellow;
        border-radius: 50%;
        opacity: 0.8;
        animation: moveSpark 1s linear infinite;
    }
    @keyframes moveSpark {
        0% { transform: translate(0,0) scale(1); opacity: 0.8; }
        50% { transform: translate(calc(-200px + 400px * var(--randX)), calc(-100px + 200px * var(--randY))) scale(0.5); opacity: 0.4; }
        100% { transform: translate(0,0) scale(1); opacity: 0; }
    }
</style>
</head>
<body>
<h1 id="msg" class="blink"></h1>
<div id="bar"><div id="fill"></div></div>

<!-- éŸ³æ•ˆ -->
<audio id="alert" src="https://www.soundjay.com/buttons/sounds/beep-07.mp3"></audio>
<audio id="laugh" src="https://www.soundjay.com/human/sounds/laugh-1.mp3"></audio>

<script>
function animateBar(target, color, speed, stopAtPercent, stopTime, callback){
    let width = 0;
    const fill = document.getElementById("fill");
    const msg = document.getElementById("msg");
    document.getElementById("bar").style.display="block";
    fill.style.background=color;
    const alertSound = document.getElementById("alert");
    alertSound.currentTime=0;
    alertSound.play();

    const interval = setInterval(()=>{
        if(stopAtPercent && width===stopAtPercent){
            clearInterval(interval);
            setTimeout(()=>{
                const remainInterval = setInterval(()=>{
                    width++;
                    fill.style.width = width+"%";
                    msg.innerHTML = target + " " + width + "%";
                    if(width>=100){
                        clearInterval(remainInterval);
                        if(callback) callback();
                    }
                }, speed);
            }, stopTime);
        } else if(width>=100){
            clearInterval(interval);
            if(callback) callback();
        } else {
            width++;
            fill.style.width = width+"%";
            msg.innerHTML = target + " " + width + "%";
        }
    }, speed);
}

function createSparks(num){
    for(let i=0;i<num;i++){
        const spark = document.createElement("div");
        spark.className="spark";
        spark.style.setProperty("--randX", Math.random());
        spark.style.setProperty("--randY", Math.random());
        spark.style.left = (50 + Math.random()*100 - 50) + "px";
        spark.style.top = "0px";
        document.body.appendChild(spark);
    }
}

function safeVibrate(){
    if(navigator.vibrate){
        navigator.vibrate([200,100,200]);
    }
}

function delay(ms){ return new Promise(r=>setTimeout(r,ms)); }

async function startSequence(){
    const msg = document.getElementById("msg");
    const laughSound = document.getElementById("laugh");

    // 1ï¸âƒ£ æ­£åœ¨æƒæç³»çµ±
    await new Promise(res => animateBar("ğŸ” æ­£åœ¨æƒæç³»çµ±ä¸­â€¦","#0f0",60,null,null,res));

    // 2ï¸âƒ£ å‡ç´šé˜²æ¯’ç³»çµ± (åˆ°89%åœ3ç§’)
    await new Promise(res => animateBar("âš¡ æ­£åœ¨å‡ç´šé˜²æ¯’ç³»çµ±ä¸­â€¦","#0ff",50,89,3000,res));

    // 3ï¸âƒ£ ç³»çµ±è­¦å‘Š
    msg.innerHTML="âš  ç³»çµ±è­¦å‘Šï¼å‡ç´šå¤±æ•—ï¼";
    safeVibrate();
    await delay(2000);

    // 4ï¸âƒ£ å‡è£ç«Šå–æ‰‹æ©Ÿè³‡æ–™
    document.getElementById("fill").style.width="0%";
    await new Promise(res => animateBar("æ­£åœ¨ç«Šå–ä½ çš„æ‰‹æ©Ÿè³‡æ–™â€¦","#0f0",60,null,null,res));

    // 5ï¸âƒ£ å‡è£ç«Šå–éŠ€è¡Œè³‡æ–™
    document.getElementById("fill").style.width="0%";
    await new Promise(res => animateBar("æ­£åœ¨ç«Šå–ä½ çš„éŠ€è¡Œè³‡æ–™â€¦","#ff0",60,null,null,res));

    // 6ï¸âƒ£ å‡è£åˆªè³‡æ–™ï¼ˆæ…¢ï¼‰
    document.getElementById("fill").style.width="0%";
    await new Promise(res => animateBar("æ­£åœ¨åˆªé™¤æ‰‹æ©Ÿè³‡æ–™â€¦","#f00",120,null,null,res));

    // 7ï¸âƒ£ ç³»çµ±å´©æ½°å€’æ•¸
    document.getElementById("bar").style.display="none";
    for(let i=3;i>0;i--){
        msg.innerHTML="âš  ç³»çµ±å³å°‡å´©æ½°å€’æ•¸ï¼š"+i;
        safeVibrate();
        await delay(1000);
    }

    // æœ€çµ‚æƒ¡æçµå°¾
    msg.style.color="#0f0";
    msg.innerHTML="ğŸ¤£ æ”¾å¿ƒå•¦ï¼ä½ æ²’äº‹å•¦ï¼æƒ¡æä¸€ä¸‹ã€‚ğŸ¤£";
    createSparks(50);
    laughSound.currentTime=0;
    laughSound.play();
}

window.onload=startSequence;
</script>
</body>
</html>